---
title: "random_sims"
author: "Thomas Cleary"
date: "07/10/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, echo=FALSE}
# Reset the Rstudio environment
reset_env <- function() {
  # clear the global namespace
  rm(list=setdiff(ls(envir = .GlobalEnv), "reset_env"), envir = .GlobalEnv)

  # un-attach loaded packages
  if (!is.null(sessionInfo()$otherPkgs)) {
    invisible(
      lapply(paste0('package:', names(sessionInfo()$otherPkgs)),
             detach, character.only=TRUE, unload=TRUE)
    )
  }

  # stop R converting strings to factors automatically
  options(stringsAsFactors = FALSE)

  library(ggplot2)
  library(patchwork)
}
```

```{r, echo=FALSE, message=FALSE, results='hide', error=FALSE, warning=FALSE}
reset_env()
```


# Get data frames for random and basic agent
```{r}
basic.spy = read.csv(paste0("../basic-spy.csv"))
basic.res = read.csv(paste0("../basic-resistance.csv"))
basic.overall = read.csv(paste0("../basic-overall.csv"))

random.spy = read.csv(paste0("../random-spy.csv"))
random.res = read.csv(paste0("../random-resistance.csv"))
random.overall = read.csv(paste0("../random-overall.csv"))

```


# Plot of random and basic agent spy performance
```{r}
last_basic_row = basic.spy[dim(basic.spy)[1],]
last_random_row = random.spy[dim(random.spy)[1],]

spy_plot = ggplot() +
  
  geom_line(
    data = random.spy, aes(x = games_played, y = spy_win_ratio, colour = "Random Agent")
  ) +
  geom_point(
    data = last_random_row, aes(x = dim(random.spy)[1], y = spy_win_ratio, colour = "Random Agent")
  ) +
  geom_text(
    data=last_random_row, 
    size=3.5,
    aes(
      x=dim(random.spy)[1], y = spy_win_ratio, 
      label = paste0(round(spy_win_ratio, 2) * 100, "%"),
      colour="Random Agent"
      ),
      vjust = -0.5,
    show.legend = FALSE
  ) + 
  
  geom_line(
    data = basic.spy, aes(x = games_played, y = spy_win_ratio, colour = "Basic Agent")
  ) +
  geom_point(
    data = last_basic_row, aes(x = dim(basic.spy)[1], y = spy_win_ratio, colour = "Basic Agent")
  ) +
  geom_text(
    data=last_basic_row, 
    size=3.5,
    aes(
      x=dim(basic.spy)[1], y = spy_win_ratio, 
      label = paste0(round(spy_win_ratio, 2) * 100, "%"),
      colour="Basic Agent",
      ),
      vjust = -0.5,
    show.legend = FALSE
  ) + 
  
  ylim(0, 1) + 
  
  scale_x_continuous(
    breaks=seq(0, last_basic_row$games_played, 100000),
    labels = scales::comma
  ) + 
  
  labs(
    subtitle = "Games Played as Spy",
    x = "",
    y = "",
    colour = "Agent"
  ) + 
  
  theme(
    axis.text.x = element_text(angle = 90)
  )
  

```

# Plot of random and basic agent res performance
```{r}
last_basic_row = basic.res[dim(basic.res)[1],]
last_random_row = random.res[dim(random.res)[1],]

res_plot = ggplot() +
  
  geom_line(
    data = random.res, aes(x = games_played, y = res_win_ratio, colour = "Random Agent")
  ) +
  geom_point(
    data = last_random_row, aes(x = dim(random.res)[1], y = res_win_ratio, colour = "Random Agent")
  ) +
  geom_text(
    data=last_random_row, 
    size=3.5,
    aes(
      x=dim(random.res)[1], y = res_win_ratio, 
      label = paste0(round(res_win_ratio, 2) * 100, "%"),
      colour="Random Agent"
      ),
      vjust = +1.5,
    show.legend = FALSE
  ) + 
  
  geom_line(
    data = basic.res, aes(x = games_played, y = res_win_ratio, colour = "Basic Agent")
  ) +
  geom_point(
    data = last_basic_row, aes(x = dim(basic.res)[1], y = res_win_ratio, colour = "Basic Agent")
  ) +
  geom_text(
    data=last_basic_row, 
    size=3.5,
    aes(
      x=dim(basic.res)[1], y = res_win_ratio, 
      label = paste0(round(res_win_ratio, 2) * 100, "%"),
      colour="Basic Agent"
      ),
      vjust = -0.5,
    show.legend = FALSE
  ) + 
  
  ylim(0, 1) + 
  
  scale_x_continuous(
    breaks=seq(0, last_basic_row$games_played, 100000),
    labels = scales::comma
  ) + 
  
  labs(
    subtitle = "Games Played as Resistance",
    x = "",
    y = "",
    colour = "Agent"
  ) + 
  
  theme(
    axis.text.x = element_text(angle = 90)
  )
  

print(res_plot)

```

# Plot of random and basic agent res performance overall
```{r}
last_basic_row = basic.overall[dim(basic.overall)[1],]
last_random_row = random.overall[dim(random.overall)[1],]

overall_plot = ggplot() +
  
  geom_line(
    data = random.overall, aes(x = games_played, y = win_ratio, colour = "Random Agent")
  ) +
  geom_point(
    data = last_random_row, aes(x = dim(random.overall)[1], y = win_ratio, colour = "Random Agent")
  ) +
  geom_text(
    data=last_random_row, 
    size=3.5,
    aes(
      x=dim(random.overall)[1], y = win_ratio, 
      label = paste0(round(win_ratio, 2) * 100, "%"),
      colour="Random Agent"
      ),
      vjust = -0.5,
    show.legend = FALSE
  ) + 
  
  geom_line(
    data = basic.overall, aes(x = games_played, y = win_ratio, colour = "Basic Agent")
  ) +
  geom_point(
    data = last_basic_row, aes(x = dim(basic.overall)[1], y = win_ratio, colour = "Basic Agent")
  ) +
  geom_text(
    data=last_basic_row, 
    size=3.5,
    aes(
      x=dim(basic.overall)[1], y = win_ratio, 
      label = paste0(round(win_ratio, 2) * 100, "%"),
      colour="Basic Agent"
      ),
      vjust = -0.5,
    show.legend = FALSE
  ) + 
  
  ylim(0, 1) + 
  
  scale_x_continuous(
    breaks=seq(0, last_basic_row$games_played, 100000),
    labels = scales::comma
  ) + 
  
  labs(
    subtitle = "All Games Played",
    x = "",
    y = "",
    colour = "Agent"
  ) + 
  
  theme(
    axis.text.x = element_text(angle = 90)
  )

```


# all 3 plots
``` {r, fig.height=3, fig.width=6}
library(ggpubr)

all.plots = ggarrange(
  spy_plot, res_plot, overall_plot,
  ncol=3, nrow=1, common.legend=TRUE,
  legend="top"
)


all.plots = annotate_figure(
  all.plots,
  top = text_grob("Win Ratio of Simple Agents with 'Random Agent' Opponents",
                  size=18, face="bold"),
  left = text_grob("Win Ratio", size=14, rot=90),
  bottom = text_grob("Games Simulated", size=14)
)

all.plots
```













